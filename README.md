# 电梯调度系统

## 项目简介

这是一个基于 LOOK 算法的电梯调度系统实现，用于优化多电梯环境下的运行效率。该系统的主要目标是最小化所有乘客的等待时间总和和 95% 乘客的等待时间总和。

## 核心功能

- **LOOK 算法实现**：电梯会在一个方向上持续移动，直到该方向上没有更多请求，然后改变方向
- **智能电梯分配**：基于电梯当前位置、运行方向、载客量和已有请求数量，为乘客分配最优电梯
- **动态方向控制**：根据实时请求情况，动态调整电梯运行方向
- **均匀初始分布**：系统初始化时，电梯会均匀分布到不同楼层，以提高响应效率
- **完整事件处理**：处理乘客呼叫、电梯停靠、乘客进出等多种事件

## 技术架构

该项目基于 Python 实现，使用 `elevator_saga` 框架提供的接口开发。主要组件如下：

- **ElevatorPlanner**：核心调度器类，继承自 `ElevatorController`
- **事件回调系统**：通过各种回调函数处理电梯运行中的不同事件
- **请求管理**：分别管理上行和下行请求，优化电梯运行路径

## 算法说明

### LOOK 算法

LOOK 算法是一种经典的磁盘调度算法的变种，适用于电梯调度场景：

1. 电梯在一个方向（上行或下行）上持续运行
2. 处理该方向上所有的请求
3. 当该方向没有更多请求时，改变方向
4. 重复上述过程

### 电梯分配策略

系统为乘客选择最佳电梯时，考虑以下因素：

- 电梯到乘客所在楼层的距离
- 电梯的运行方向（优先选择同方向的电梯）
- 电梯的载客量
- 电梯当前的请求数量

## 代码结构

```
elevator_hw/
├── README.md            # 项目说明文档
└── elevator_planner.py  # 电梯调度系统的核心实现
```

## 关键组件说明

### ElevatorPlanner 类

核心调度器类，实现了电梯调度的所有逻辑：

- **初始化方法**：设置基本参数，初始化数据结构
- **事件处理方法**：处理各种电梯运行事件
- **辅助方法**：实现请求分配、目标更新等核心算法

### 主要数据结构

- `elevator_directions`：记录每个电梯的当前运行方向
- `elevator_up_requests`：记录每个电梯的上行请求
- `elevator_down_requests`：记录每个电梯的下行请求
- `max_floor`：最大楼层数
- `floors`：所有楼层的列表
- `elevators`：所有电梯的列表

### 核心方法

- `on_init()`：系统初始化
- `on_passenger_call()`：处理乘客呼叫请求
- `_find_best_elevator_for_passenger()`：为乘客分配最佳电梯
- `_update_elevator_target()`：更新电梯的目标楼层
- `_ensure_elevator_has_target()`：确保电梯始终有运行目标

## 使用说明

### 前提条件

- Python 3.x
- elevator_saga 框架

### 运行方法

直接运行 `elevator_planner.py` 文件：

```bash
python elevator_planner.py
```

### 调试模式

默认启用调试模式，可以在控制台查看电梯运行的详细日志。如需关闭调试模式，可修改主函数中的参数：

```python
planner = ElevatorPlanner(debug=False)
```

## 优化目标

该系统的主要优化目标是：

1. 最小化所有乘客的等待时间总和
2. 最小化 95% 乘客的等待时间总和

通过 LOOK 算法和智能电梯分配策略，系统能够在高负载情况下保持较好的性能表现。

## 扩展与改进方向

1. 考虑楼层客流量的历史数据，进行预测性调度
2. 实现更复杂的电梯分组策略，如分区服务
3. 添加故障检测和恢复机制
4. 优化高峰期的调度策略
5. 添加图形化监控界面，直观展示电梯运行状态